<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Daily Games Hub</title>
		<style>
			body {
				font-family: sans-serif;
				line-height: 1.5;
				padding: 1rem;
			}
			a {
				color: blue;
				text-decoration: underline;
			}
			a.completed {
				pointer-events: none;
				color: inherit;
				text-decoration: none;
			}

			#resultsOutput {
				white-space: pre-wrap;
				background: #f9f9f9;
				padding: 1rem;
				border: 1px solid #ddd;
			}
		</style>
	</head>
	<body>
		<h1>Super DLE Gaming3000</h1>

		<ul>
			<li id="connections">
				<span class="status"></span>
				<a
					href="https://www.nytimes.com/games/connections"
					target="_blank"
					rel="noopener"
					>Connections</a
				>
			</li>
			<li id="foodguessr">
				<span class="status"></span>
				<a href="https://www.foodguessr.com/" target="_blank" rel="noopener"
					>Foodguessr</a
				>
			</li>
			<li id="tradle">
				<span class="status"></span>
				<a href="https://tradle.net/" target="_blank" rel="noopener">Tradle</a>
			</li>
			<li id="pick5">
				<span class="status"></span>
				<a
					href="https://oec.world/en/games/pick-5"
					target="_blank"
					rel="noopener"
					>Pick5</a
				>
			</li>
		</ul>

		<button id="manualCheck">Check clipboard</button>

		<h2>Results</h2>
		<pre id="resultsOutput">No results yet.</pre>
		<button id="shareAll">Share</button>

		<script>
			// Store collected results in an array.
			const results = {
				connections: "",
				foodguessr: "",
				tradle: "",
				pick5: "",
			};

			function markCompleted(gameId) {
				const game = document.getElementById(gameId);
				game.querySelector(".status").textContent = "âœ…";
				game.querySelector("a").classList.add("completed");
			}

			// Update the display of collected results.
			function updateResults() {
				let completed = 0;

				let date = new Date();
				let day = date.getDate();
				let month = date.getMonth() + 1;
				let year = date.getFullYear();
				let shortYear = year.toString().slice(-2);

				let output = `dle.eric.tc - ${day}/${month}/${shortYear}\n\n`;

				for (const [game, result] of Object.entries(results)) {
					if (!result) {
						continue;
					}

					markCompleted(game);
					completed++;
					output += `${result}\n\n`;
				}

				if (completed > 0) {
					document.getElementById("resultsOutput").textContent = output.trim();
				} else {
					document.getElementById("resultsOutput").textContent =
						"No results yet.";
				}
			}

			function registerResult(text) {
				if (!text || text.trim().length <= 0) {
					return false;
				}

				if (text.startsWith("FoodGuessr")) {
					const processed = text.split("\n").slice(0, -3).join("\n");
					results.foodguessr = processed;
					return true;
				} else if (text.startsWith("Connections")) {
					results.connections = text;
					return true;
				} else if (text.startsWith("#Tradle")) {
					const processed = text.split("\n").slice(0, -1).join("\n");
					results.tradle = processed;
					return true;
				} else if (text.startsWith("Pick5")) {
					const processed = text.split("\n").slice(0, -2).join("\n");
					results.pick5 = processed;
					return true;
				}
			}

			// Try reading from the clipboard.
			async function checkClipboard() {
				try {
					const text = await navigator.clipboard.readText();
					if (registerResult(text)) {
						updateResults();
					}
				} catch (err) {
					console.error("Error reading clipboard:", err);
				}
			}

			// Clipboard checking
			document.getElementById("manualCheck").addEventListener("click", () => {
				checkClipboard();
			});
			document.addEventListener("visibilitychange", () => {
				if (document.visibilityState === "visible") {
					//allow focus events to settle
					setTimeout(() => {
						checkClipboard();
					}, 500);
				}
			});

			// Combine results
			document
				.getElementById("shareAll")
				.addEventListener("click", async () => {
					const finalMessage =
						document.getElementById("resultsOutput").textContent;
					try {
						await navigator.clipboard.writeText(finalMessage);
						alert("Results copied to clipboard c:");
					} catch (err) {
						console.error("Error copying results:", err);
					}
				});
		</script>
	</body>
</html>
